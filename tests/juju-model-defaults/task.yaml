summary: Run concierge with just a MicroK8s provider
systems:
  - ubuntu-24.04

execute: |
  pushd "${PROJECT_PATH}/tests/provider-microk8s"

  "$PROJECT_PATH"/concierge -v

  juju controllers | tail -n1 | MATCH concierge-microk8s
  juju models | tail -n1 | MATCH testing

  juju model-defaults | grep test-mode | tr -s " " | MATCH "test-mode false true"
  juju model-defaults | grep automatically-retry-hooks | tr -s " " | MATCH "automatically-retry-hooks true false"

restore: |
  sudo snap remove juju --purge
  sudo snap remove lxd --purge
