summary: Run concierge with no providers, but add extra snaps/debs from config
systems:
  - ubuntu-24.04

execute: |
  pushd "${PROJECT_PATH}/tests/extra-packages-config-file"

  "$PROJECT_PATH"/concierge --trace prepare

  command -v pip | MATCH /usr/bin/pip
  python3 -m venv -h | head -n1 | grep -q -e "usage: venv"

  list="$(snap list)"
  echo $list | MATCH charmcraft
  echo $list | MATCH jq

restore: |
  if [[ -z "${CI:-}" ]]; then
    "$PROJECT_PATH"/concierge --trace restore
  fi
